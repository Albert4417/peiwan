<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.peiwan.dao.RankingListMapper">


    <!-- 动态查询 -->
    <select id="getHotRanking" parameterType="map" resultType="map">
        SELECT po.pid,po.person_nickname,po.person_image,po.z_zhubo,po.oid,g.gid,po.pos
        FROM
        (
        SELECT p.pid,p.person_nickname,p.person_image,p.z_zhubo,o.oid,o.o_createtime,o.o_money,COUNT(o.oid) pos
        FROM p_person p
        LEFT JOIN o_order_z o ON p.pid = o.pid
        WHERE p.z_zhubo = 1
        GROUP BY p.pid) po
        LEFT JOIN g_service g ON po.pid = g.pid
        WHERE po.z_zhubo = 1
        <if test="gid != null and gid != ''">
            AND g.gid = #{gid}
        </if>
        <if test="days != null and days !=''">
            <![CDATA[and po.o_createtime > date_sub(now(), interval #{days} day)]]>
        </if>
        GROUP BY po.pid
        order by pos DESC
        limit 0,3
    </select>

</mapper>
