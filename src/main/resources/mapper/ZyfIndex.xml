<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.peiwan.dao.ZyfIndexMapper">

    <!--热门推荐主播列表-->
    <select id="selectHotPersonList" parameterType="map" resultType="map">
        select p.pid,p.person_nickname,p.person_image,s.g_name,s.g_price from t_person p,t_service s where p.pid=s.pid
        limit ${pageSize*(curPage-1)},${pageSize}
    </select>


    <!--导航栏根据昵称和Id模糊查询-->
    <select id="selectPersonByNameAndId" parameterType="map" resultType="map">
            SELECT
            p.pid,p.person_nickname,p.person_image,s.g_name,s.g_price
            FROM t_person p LEFT JOIN t_service s ON p.pid=s.pid
            WHERE p.z_zhubo=1
            <if test="pid != null and pid != ''">
                AND p.pid=#{pid}
            </if>
            <if test="personNickname != null and personNickname != ''">
                AND p.person_nickname like "%"#{personNickname}"%"
            </if>
    </select>



    <!--热度榜 周榜 前三：先筛选规定时间，然后按照订单数排序-->
    <select id="selectOrderListTop" parameterType="map" resultType="map">
        SELECT op.pid,op.person_nickname,op.person_image,op.person_adress,op.person_sex,op.o_createtime,op.oo
        FROM(SELECT p.pid,p.person_nickname,p.person_image,p.person_adress,p.person_sex,o.o_createtime,COUNT(o.oid) oo
             FROM t_person p LEFT JOIN t_order_z o ON p.pid=o.pid
             WHERE o.o_createtime>DATE_SUB(CURDATE(), INTERVAL 1 WEEK)
               AND o.o_flate=1 GROUP BY o.pid ORDER BY COUNT(o.oid) DESC LIMIT 3)op
    </select>
    <!--热度榜 周榜 第四到第十：先筛选规定时间，然后按照订单数排序-->
    <select id="selectOrderList" parameterType="map" resultType="map">
        SELECT op.pid,op.person_nickname,op.person_image,op.person_adress,op.person_sex,op.o_createtime,op.oo
        FROM(SELECT p.pid,p.person_nickname,p.person_image,p.person_adress,p.person_sex,o.o_createtime,COUNT(o.oid) oo
             FROM t_person p LEFT JOIN t_order_z o ON p.pid=o.pid
             WHERE o.o_createtime>DATE_SUB(CURDATE(), INTERVAL 1 WEEK)
               AND o.o_flate=1 GROUP BY o.pid ORDER BY COUNT(o.oid) DESC LIMIT 4,10)op
    </select>

    <!--热度榜 总榜 前三：查询主播总订单数-->
    <select id="selectOrderListAllTop" parameterType="map" resultType="map">
        SELECT op.pid,op.person_nickname,op.person_image,op.person_adress,op.person_sex,op.o_createtime,op.oo
        FROM(SELECT p.pid,p.person_nickname,p.person_image,p.person_adress,p.person_sex,o.o_createtime,COUNT(o.oid) oo
             FROM t_person p LEFT JOIN t_order_z o ON p.pid=o.pid
             WHERE o.o_flate=1 GROUP BY o.pid ORDER BY COUNT(o.oid) DESC LIMIT 3)op
    </select>
    <!--热度榜 总榜 第四到第十：查询主播总订单数-->
    <select id="selectOrderListAll" parameterType="map" resultType="map">
        SELECT op.pid,op.person_nickname,op.person_image,op.person_adress,op.person_sex,op.o_createtime,op.oo
        FROM(SELECT p.pid,p.person_nickname,p.person_image,p.person_adress,p.person_sex,o.o_createtime,COUNT(o.oid) oo
             FROM t_person p LEFT JOIN t_order_z o ON p.pid=o.pid
             WHERE o.o_flate=1 GROUP BY o.pid ORDER BY COUNT(o.oid) DESC LIMIT 4,10)op
    </select>




    <!--人气榜 周榜 前三：先按照规定时间筛选，根据主播的接单总时长来排序-->
    <select id="selectTimeListTop" parameterType="map" resultType="map">
        SELECT op.pid,op.person_nickname,op.person_image,op.o_createtime,op.ot
        FROM(SELECT p.pid,p.person_nickname,p.person_image,o.o_createtime,SUM(o.o_xiadanshijian)ot
             FROM t_person p LEFT JOIN t_order_z o ON p.pid=o.pid
             WHERE o.o_createtime>DATE_SUB(CURDATE(), INTERVAL 1 WEEK)
               AND o.o_flate=1 GROUP BY o.pid ORDER BY SUM(o.o_xiadanshijian) DESC LIMIT 3)op
    </select>
    <!--人气榜 周榜 第四到第十：先按照规定时间筛选，根据主播的接单总时长来排序-->
    <select id="selectTimeList" parameterType="map" resultType="map">
        SELECT op.pid,op.person_nickname,op.person_image,op.o_createtime,op.ot
        FROM(SELECT p.pid,p.person_nickname,p.person_image,o.o_createtime,SUM(o.o_xiadanshijian)ot
             FROM t_person p LEFT JOIN t_order_z o ON p.pid=o.pid
             WHERE o.o_createtime>DATE_SUB(CURDATE(), INTERVAL 1 WEEK)
              AND o.o_flate=1 GROUP BY o.pid ORDER BY SUM(o.o_xiadanshijian) DESC LIMIT 4,10)op
    </select>

    <!--人气榜 总榜 前三：根据主播的接单总时长来排序-->
    <select id="selectTimeListAllTop" parameterType="map" resultType="map">
        SELECT op.pid,op.person_nickname,op.person_image,op.o_createtime,op.ot
        FROM (SELECT p.pid,p.person_nickname,p.person_image,o.o_createtime,SUM(o.o_xiadanshijian)ot
              FROM t_person p LEFT JOIN t_order_z o ON p.pid=o.pid
              WHERE o.o_flate=1 GROUP BY o.pid ORDER BY SUM(o.o_xiadanshijian) DESC LIMIT 3)op
    </select>
    <!--人气榜 总榜 第四到第十：根据主播的接单总时长来排序-->
    <select id="selectTimeListAll" parameterType="map" resultType="map">
        SELECT op.pid,op.person_nickname,op.person_image,op.o_createtime,op.ot
        FROM (SELECT p.pid,p.person_nickname,p.person_image,o.o_createtime,SUM(o.o_xiadanshijian)ot
              FROM t_person p LEFT JOIN t_order_z o ON p.pid=o.pid
              WHERE o.o_flate=1 GROUP BY o.pid ORDER BY SUM(o.o_xiadanshijian) DESC LIMIT 4,10)op
    </select>




    <!--富豪榜 周榜 前三 : 先按照规定时间筛选，然后按照用户充值总金额排序-->
    <select id="selectMoneyListTop" parameterType="map" resultType="map">
        SELECT op.pid,op.person_nickname,op.person_image,op.om
        FROM (SELECT p.pid,p.person_nickname,p.person_image,SUM(o.o_money)om
              FROM t_person p LEFT JOIN t_order o ON p.pid=o.pid
              WHERE o.o_createtime>DATE_SUB(CURDATE(),INTERVAL 1 WEEK)
                AND o.o_flate=1 GROUP BY o.pid ORDER BY SUM(o.o_money) DESC LIMIT 3)op
    </select>
    <!--富豪榜 周榜 第四到第十 : 先按照规定时间筛选，然后按照用户充值总金额排序-->
    <select id="selectMoneyList" parameterType="map" resultType="map">
        SELECT op.pid,op.person_nickname,op.person_image,op.om
        FROM (SELECT p.pid,p.person_nickname,p.person_image,SUM(o.o_money)om
              FROM t_person p LEFT JOIN t_order o ON p.pid=o.pid
              WHERE o.o_createtime>DATE_SUB(CURDATE(),INTERVAL 1 WEEK)
              AND o.o_flate=1 GROUP BY o.pid ORDER BY SUM(o.o_money) DESC LIMIT 4,10)op
    </select>

    <!--富豪榜 总榜 前三:查询用户充值总金额-->
    <select id="selectMoneyListAllTop" parameterType="map" resultType="map">
        SELECT op.pid,op.person_nickname,op.person_image,op.om
        FROM (SELECT p.pid,p.person_nickname,p.person_image,SUM(o.o_money)om
              FROM t_person p LEFT JOIN t_order o ON p.pid=o.pid
              WHERE o.o_flate=1 GROUP BY o.pid ORDER BY SUM(o.o_money) DESC LIMIT 3)op
    </select>
    <!--富豪榜 总榜 第四到第十:查询用户充值总金额-->
    <select id="selectMoneyListAll" parameterType="map" resultType="map">
        SELECT op.pid,op.person_nickname,op.person_image,op.om
        FROM (SELECT p.pid,p.person_nickname,p.person_image,SUM(o.o_money)om
              FROM t_person p LEFT JOIN t_order o ON p.pid=o.pid
              WHERE o.o_flate=1 GROUP BY o.pid ORDER BY SUM(o.o_money) DESC LIMIT 4,10)op
    </select>

    


</mapper>
