<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.peiwan.dao.ZyfIndexMapper">

    <!--导航栏根据昵称和Id模糊查询-->
    <select id="selectPersonByNameAndId" parameterType="map" resultType="map">
  <!--SELECT sp.pid,sp.person_nickname,sp.person_image,sp.gid,sp.g_price,sp.sg,sp.om
        FROM (SELECT p.pid,p.person_nickname,p.person_image,s.gid,s.g_price,GROUP_CONCAT(DISTINCT s.g_name)sg,SUM(o.o_money)om
        FROM (t_person p LEFT JOIN t_service s ON p.pid=s.pid ) LEFT JOIN t_order_z o ON p.pid=o.pid
        WHERE p.person_flate=1
        <if test="pid != null and pid != ''">
              AND p.pid=#{pid}
        </if>
        <if test="personNickname != null and personNickname != ''">
              AND p.person_nickname like "%"#{personNickname}"%"
        </if>
        GROUP BY p.pid LIMIT 12) sp-->
        SELECT * FROM t_service s,(SELECT p.pid,p.person_nickname,p.person_image
        FROM t_person p WHERE p.person_flate=1
        <if test="pid != null and pid != ''">
            AND p.pid=#{pid}
        </if>
        <if test="personNickname != null and personNickname != ''">
            AND p.person_nickname like "%"#{personNickname}"%"
        </if>)pp
        where pp.pid=s.pid GROUP BY s.pid LIMIT 12
    </select>

    <!--热门推荐主播列表-->
    <select id="selectHotPersonList" parameterType="map" resultType="map">
       SELECT sp.pid,sp.person_nickname,sp.person_image,sp.gid,sp.g_name,sp.g_price,sp.om
       FROM(SELECT p.pid,p.person_nickname,p.person_image,s.gid,s.g_name,s.g_price,SUM(o.o_money)om
            FROM (t_person p LEFT JOIN t_service s ON p.pid=s.pid ) LEFT JOIN t_order_z o ON p.pid=o.pid
            WHERE person_flate=1 GROUP BY p.pid LIMIT ${pageSize*(curPage-1)},${pageSize} )sp
    </select>

    <!--新人推荐-->
    <select id="selectNewPersonList" parameterType="map" resultType="map">
        SELECT * FROM t_service s,(SELECT p.pid,p.person_image,p.person_nickname FROM t_person p WHERE person_flate=1 AND person_becometime>DATE_SUB(CURDATE(),INTERVAL 2 WEEK))p
        WHERE p.pid=s.pid GROUP BY s.pid LIMIT 20
    </select>



    <!--魅力榜 周榜 前三：先筛选规定时间，然后按照订单数排序-->
    <select id="selectOrderListTop" parameterType="map" resultType="map">
        SELECT op.pid,op.person_nickname,op.person_image,op.person_adress,op.person_sex,op.person_birthday,op.gid,op.o_createtime,op.oo
        FROM(SELECT p.pid,p.person_nickname,p.person_image,p.person_adress,p.person_sex,p.person_birthday,s.gid,o.o_createtime,COUNT(o.oid) oo
             FROM (t_person p LEFT JOIN t_order_z o ON p.pid=o.pid) left join t_service s on p.pid=s.pid
             WHERE o.o_createtime>DATE_SUB(CURDATE(), INTERVAL 2 WEEK)
             AND o.o_flate=1 AND p.person_flate=1 GROUP BY o.pid ORDER BY COUNT(o.oid) DESC LIMIT 3)op
    </select>
    <!--魅力榜 周榜 第四到第十：先筛选规定时间，然后按照订单数排序-->
    <select id="selectOrderList" parameterType="map" resultType="map">
        SELECT op.pid,op.person_nickname,op.person_image,op.person_adress,op.person_sex,op.person_birthday,op.gid,op.o_createtime,op.oo
        FROM(SELECT p.pid,p.person_nickname,p.person_image,p.person_adress,p.person_sex,p.person_birthday,s.gid,o.o_createtime,COUNT(o.oid) oo
             FROM (t_person p LEFT JOIN t_order_z o ON p.pid=o.pid) left join t_service s on p.pid=s.pid
             WHERE o.o_createtime>DATE_SUB(CURDATE(), INTERVAL 2 WEEK)
               AND o.o_flate=1 AND p.person_flate=1 GROUP BY o.pid ORDER BY COUNT(o.oid) DESC LIMIT 4,10)op
    </select>

    <!--魅力榜 总榜 前三：查询主播总订单数-->
    <select id="selectOrderListAllTop" parameterType="map" resultType="map">
        SELECT op.pid,op.person_nickname,op.person_image,op.person_adress,op.person_sex,op.person_birthday,op.gid,op.o_createtime,op.oo
        FROM(SELECT p.pid,p.person_nickname,p.person_image,p.person_adress,p.person_sex,p.person_birthday,s.gid,o.o_createtime,COUNT(o.oid) oo
             FROM (t_person p LEFT JOIN t_order_z o ON p.pid=o.pid) left join t_service s on p.pid=s.pid
             WHERE o.o_flate=1 AND p.person_flate=1 GROUP BY o.pid ORDER BY COUNT(o.oid) DESC LIMIT 3)op
    </select>
    <!--魅力榜 总榜 第四到第十：查询主播总订单数-->
    <select id="selectOrderListAll" parameterType="map" resultType="map">
        SELECT op.pid,op.person_nickname,op.person_image,op.person_adress,op.person_sex,op.person_birthday,op.gid,op.o_createtime,op.oo
        FROM(SELECT p.pid,p.person_nickname,p.person_image,p.person_adress,p.person_sex,p.person_birthday,s.gid,o.o_createtime,COUNT(o.oid) oo
             FROM (t_person p LEFT JOIN t_order_z o ON p.pid=o.pid) left join t_service s on p.pid=s.pid
             WHERE o.o_flate=1 AND p.person_flate=1 GROUP BY o.pid ORDER BY COUNT(o.oid) DESC LIMIT 4,10)op
    </select>




    <!--人气榜 周榜 前三：先按照规定时间筛选，根据主播的接单总时长来排序-->
    <select id="selectTimeListTop" parameterType="map" resultType="map">
        SELECT op.pid,op.person_nickname,op.person_image,op.person_adress,op.person_sex,op.person_birthday,op.gid,op.o_createtime,op.ot
        FROM(SELECT p.pid,p.person_nickname,p.person_image,p.person_adress,p.person_sex,p.person_birthday,s.gid,o.o_createtime,SUM(o.o_xiadanshijian)ot
             FROM (t_person p LEFT JOIN t_order_z o ON p.pid=o.pid) left join t_service s on p.pid=s.pid
             WHERE o.o_createtime>DATE_SUB(CURDATE(), INTERVAL 2 WEEK)
               AND o.o_flate=1 AND p.person_flate=1 GROUP BY o.pid ORDER BY SUM(o.o_xiadanshijian) DESC LIMIT 3)op
    </select>
    <!--人气榜 周榜 第四到第十：先按照规定时间筛选，根据主播的接单总时长来排序-->
    <select id="selectTimeList" parameterType="map" resultType="map">
        SELECT op.pid,op.person_nickname,op.person_image,op.person_adress,op.person_sex,op.person_birthday,op.gid,op.o_createtime,op.ot
        FROM(SELECT p.pid,p.person_nickname,p.person_image,p.person_adress,p.person_sex,p.person_birthday,s.gid,o.o_createtime,SUM(o.o_xiadanshijian)ot
             FROM (t_person p LEFT JOIN t_order_z o ON p.pid=o.pid) left join t_service s on p.pid=s.pid
             WHERE o.o_createtime>DATE_SUB(CURDATE(), INTERVAL 2 WEEK)
              AND o.o_flate=1 AND p.person_flate=1 GROUP BY o.pid ORDER BY SUM(o.o_xiadanshijian) DESC LIMIT 4,10)op
    </select>

    <!--人气榜 总榜 前三：根据主播的接单总时长来排序-->
    <select id="selectTimeListAllTop" parameterType="map" resultType="map">
        SELECT op.pid,op.person_nickname,op.person_image,op.person_adress,op.person_sex,op.person_birthday,op.gid,op.o_createtime,op.ot
        FROM (SELECT p.pid,p.person_nickname,p.person_image,p.person_adress,p.person_sex,p.person_birthday,s.gid,o.o_createtime,SUM(o.o_xiadanshijian)ot
              FROM (t_person p LEFT JOIN t_order_z o ON p.pid=o.pid) left join t_service s on p.pid=s.pid
              WHERE o.o_flate=1 AND p.person_flate=1 GROUP BY o.pid ORDER BY SUM(o.o_xiadanshijian) DESC LIMIT 3)op
    </select>
    <!--人气榜 总榜 第四到第十：根据主播的接单总时长来排序-->
    <select id="selectTimeListAll" parameterType="map" resultType="map">
        SELECT op.pid,op.person_nickname,op.person_image,op.person_adress,op.person_sex,op.person_birthday,op.gid,op.o_createtime,op.ot
        FROM (SELECT p.pid,p.person_nickname,p.person_image,p.person_adress,p.person_sex,p.person_birthday,s.gid,o.o_createtime,SUM(o.o_xiadanshijian)ot
              FROM (t_person p LEFT JOIN t_order_z o ON p.pid=o.pid) left join t_service s on p.pid=s.pid
              WHERE o.o_flate=1 AND p.person_flate=1 GROUP BY o.pid ORDER BY SUM(o.o_xiadanshijian) DESC LIMIT 4,10)op
    </select>




    <!--富豪榜 周榜 前三 : 先按照规定时间筛选，然后按照用户充值总金额排序-->
    <select id="selectMoneyListTop" parameterType="map" resultType="map">
        SELECT op.pid,op.person_nickname,op.person_image,op.person_adress,op.person_sex,op.person_birthday,op.om
        FROM (SELECT p.pid,p.person_nickname,p.person_image,p.person_adress,p.person_sex,p.person_birthday,SUM(o.o_money)om
              FROM t_person p LEFT JOIN t_order o ON p.pid=o.pid
              WHERE o.o_createtime>DATE_SUB(CURDATE(),INTERVAL 2 WEEK)
                AND o.o_flate=1 AND p.person_flate=0 GROUP BY o.pid ORDER BY SUM(o.o_money) DESC LIMIT 3)op
    </select>
    <!--富豪榜 周榜 第四到第十 : 先按照规定时间筛选，然后按照用户充值总金额排序-->
    <select id="selectMoneyList" parameterType="map" resultType="map">
        SELECT op.pid,op.person_nickname,op.person_image,op.person_adress,op.person_sex,op.person_birthday,op.om
        FROM (SELECT p.pid,p.person_nickname,p.person_image,p.person_adress,p.person_sex,p.person_birthday,SUM(o.o_money)om
              FROM t_person p LEFT JOIN t_order o ON p.pid=o.pid
              WHERE o.o_createtime>DATE_SUB(CURDATE(),INTERVAL 2 WEEK)
              AND o.o_flate=1 AND p.person_flate=0 GROUP BY o.pid ORDER BY SUM(o.o_money) DESC LIMIT 4,10)op
    </select>

    <!--富豪榜 总榜 前三:查询用户充值总金额-->
    <select id="selectMoneyListAllTop" parameterType="map" resultType="map">
        SELECT op.pid,op.person_nickname,op.person_image,op.person_adress,op.person_sex,op.person_birthday,op.om
        FROM (SELECT p.pid,p.person_nickname,p.person_image,p.person_adress,p.person_sex,p.person_birthday,SUM(o.o_money)om
              FROM t_person p LEFT JOIN t_order o ON p.pid=o.pid
              WHERE o.o_flate=1 AND p.person_flate=0 GROUP BY o.pid ORDER BY SUM(o.o_money) DESC LIMIT 3)op
    </select>
    <!--富豪榜 总榜 第四到第十:查询用户充值总金额-->
    <select id="selectMoneyListAll" parameterType="map" resultType="map">
        SELECT op.pid,op.person_nickname,op.person_image,op.person_adress,op.person_sex,op.person_birthday,op.om
        FROM (SELECT p.pid,p.person_nickname,p.person_image,p.person_adress,p.person_sex,p.person_birthday,SUM(o.o_money)om
              FROM t_person p LEFT JOIN t_order o ON p.pid=o.pid
              WHERE o.o_flate=1 AND p.person_flate=0 GROUP BY o.pid ORDER BY SUM(o.o_money) DESC LIMIT 4,10)op
    </select>

    


</mapper>
