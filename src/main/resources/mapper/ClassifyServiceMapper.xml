<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper  namespace="com.peiwan.dao.ClassifyMapper">

    <!-- 通用查询映射结果 -->
    <!--<resultMap id="BaseResultMap" type="com.peiwan.bean.GSortDuanwei">
        <id column="aid" property="aid" />
        <result column="pid" property="pid" />
        <result column="z_zhubo" property="zZhubo" />
    </resultMap>

    &lt;!&ndash; 通用查询结果列 &ndash;&gt;
    <sql id="Base_Column_List">
        pid, aid, z_zhubo
    </sql>-->


    <!-- 动态查询 -->
    <select id="getCondition" parameterType="map" resultType="map">
        SELECT po.pid,po.person_nickname,po.person_sex,po.person_age,po.person_adress,po.person_coverphoto,po.pos,po.person_createtime
        FROM(
        SELECT p.pid,p.person_nickname,p.person_sex,p.person_age,p.person_adress,p.person_coverphoto,p.person_createtime,p.z_zhubo,COUNT(o.pid) pos
        FROM p_person p
        INNER JOIN o_order_z o ON p.pid=o.pid
        WHERE p.z_zhubo=1
        GROUP BY o.pid) po inner join g_service g on po.pid=g.pid where po.z_zhubo=1
        <if test="map.gid != null and map.gid != ''">
            and g.gid = #{map.gid}
        </if>
        <if test="map.gDw != null and map.gDw != ''">
            and g.g_duanwei like concat("%",#{map.gDw},"%")
        </if>
        <if test="map.psex != null and map.psex != ''">
            and po.person_sex = #{map.psex}
        </if>
        <if test="map.hot !=null and map.hot !=''">
            group by po.pos
        </if>
        <if test="map.newest != null and map.newest !='' and map.hot !=null and map.hot !=''">
            ,
        </if>
        <if test="map.newest != null and map.newest !='' and (map.hot = null or map.hot = '')">
            group by po.person_createtime desc
        </if>
        <if test="map.newest != null and map.newest !='' and map.hot != null and map.hot != ''">
            po.person_createtime desc
        </if>
    </select>

</mapper>
