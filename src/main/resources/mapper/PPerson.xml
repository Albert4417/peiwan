<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.peiwan.dao.AAttentionMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.peiwan.bean.PPerson">
        <id column="pid" property="pid" />
        <result column="person_nickname" property="personNickname" />
        <result column="person_name" property="personName" />
        <result column="person_pwd" property="personPwd" />
        <result column="person_tel" property="personTel" />
        <result column="person_sex" property="personSex" />
        <result column="person_age" property="personAge" />
        <result column="person_qq" property="personQq" />
        <result column="person_wexin" property="personWexin" />
        <result column="person_image" property="personImage" />
        <result column="person_adress" property="personAdress" />
        <result column="person_content" property="personContent" />
        <result column="person_height" property="personHeight" />
        <result column="person_weight" property="personWeight" />
        <result column="person_career" property="personCareer" />
        <result column="person_interest" property="personInterest" />
        <result column="person_coverphoto" property="personCoverphoto" />
        <result column="person_servicedescription" property="personServicedescription" />
        <result column="person_createtime" property="personCreatetime" />
        <result column="person_flate" property="personFlate" />
        <result column="person_logintime" property="personLogintime" />
        <result column="z_zhubo" property="zZhubo" />
    </resultMap>


    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        pid, person_nickname, person_name, person_pwd, person_tel, person_sex, person_age, person_qq, person_wexin, person_image, person_adress, person_content, person_height, person_weight, person_career, person_interest, person_coverphoto, person_servicedescription, person_createtime, person_flate, person_logintime, z_zhubo
    </sql>

    <!--导航栏根据昵称和Id模糊查询-->
    <select id="selectPersonByNameAndId" parameterType="map" resultType="map">
            SELECT
            p.pid,p.person_nickname,p.person_image,g.g_name,g.g_price
            FROM p_person p LEFT JOIN g_service g ON p.pid=g.pid
            WHERE p.z_zhubo=1
            <if test="pid != null and pid != ''">
                AND p.pid=#{pid}
            </if>
            <if test="personNickname != null and personNickname != ''">
                AND p.person_nickname like "%"#{personNickname}"%"
            </if>
    </select>

    <!--热度榜查询主播订单数：先按照订单数排序，再查询主播详细信息-->
    <select id="selectOrderList" parameterType="map" resultType="map">
      SELECT p.pid,p.person_nickname,p.person_image,p.person_adress,p.person_sex,p.person_age,COUNT(o.oid)
      FROM p_person p LEFT JOIN o_order_z o ON p.pid=o.pid
      WHERE o_flate=1 GROUP by p.pid
    </select>
    <!--热度榜查询主播接单数-->
    <select id="selectOrderCount" parameterType="int" resultType="int" >
        SELECT COUNT(o.oid)
        FROM p_person p LEFT JOIN o_order_z o ON p.pid=o.pid
        WHERE o_flate=1
    </select>


</mapper>
